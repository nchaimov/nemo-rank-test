# This file should be placed somewhere in $PYTHONPATH, either in a directory
# added manually, or in a site-packages directory for a virtual environment.

# If $PMI_RANK is set and $OMPI_COMM_WORLD_RANK is not set, this will
# set OMPI_COMM_WORLD_RANK=$PMI_RANK when Python starts.
# This allows NVIDIA NeMo to work with mpirun from MVAPICH.
# NeMo assumes that it is being launched through Slurm or Open MPI;
# this works around that restriction.

import os

try:
    pmi_rank = os.environ.get('PMI_RANK')
    ompi_rank = os.environ.get('OMPI_COMM_WORLD_RANK')
    if ompi_rank is None and pmi_rank is not None:
        os.environ['OMPI_COMM_WORLD_RANK'] = pmi_rank
except Exception:
    pass
